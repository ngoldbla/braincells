<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶â Brain Cells - Intelligent Spreadsheet Automation</title>
    <link rel="stylesheet" href="custom-styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #F4F4F4 0%, #FFFFFF 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: #231F20;
            color: white;
            padding: 1rem 2rem;
            border-bottom: 3px solid #FDBB30;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 2rem;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .tagline {
            color: #FDBB30;
            font-size: 0.9rem;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .nav-btn {
            background: #FDBB30;
            color: #231F20;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
        }

        .main-container {
            flex: 1;
            display: flex;
            padding: 2rem;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .sidebar {
            width: 250px;
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .sidebar h3 {
            color: #231F20;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #FDBB30;
        }

        .model-select {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .spreadsheet-container {
            flex: 1;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .toolbar {
            background: #F4F4F4;
            padding: 1rem;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .tool-btn {
            background: white;
            border: 1px solid #ddd;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tool-btn:hover {
            background: #FDBB30;
            border-color: #FDBB30;
        }

        .spreadsheet {
            overflow: auto;
            height: calc(100vh - 300px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #231F20;
            color: white;
            padding: 0.75rem;
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            border: 1px solid #ddd;
            padding: 0.5rem;
            position: relative;
        }

        td input {
            width: 100%;
            border: none;
            padding: 0.25rem;
            font-family: inherit;
        }

        td:hover {
            background: linear-gradient(135deg, #FFF 0%, #FFE5B4 100%);
            border-color: #FDBB30;
        }

        .cell-active {
            border: 2px solid #FDBB30 !important;
            box-shadow: 0 0 10px rgba(253, 187, 48, 0.3);
        }

        .brain-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        td:hover .brain-indicator {
            opacity: 1;
        }

        .processing {
            background: linear-gradient(135deg, #FFE5B4 0%, #FDBB30 100%);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .footer {
            background: #231F20;
            color: #FDBB30;
            text-align: center;
            padding: 1rem;
            border-top: 2px solid #FDBB30;
        }

        .footer a {
            color: #FDBB30;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .welcome-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            max-width: 600px;
            z-index: 1000;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .welcome-modal h2 {
            color: #231F20;
            margin-bottom: 1rem;
        }

        .welcome-modal .logo-large {
            font-size: 4rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .feature-list {
            list-style: none;
            margin: 1.5rem 0;
        }

        .feature-list li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .feature-list li:before {
            content: "üß†";
            position: absolute;
            left: 0;
        }

        .get-started-btn {
            background: #FDBB30;
            color: #231F20;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
        }

        .get-started-btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Welcome Modal -->
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="welcome-modal" id="welcomeModal">
        <div class="logo-large">ü¶â</div>
        <h2>Welcome to Brain Cells</h2>
        <p><strong>Intelligent Spreadsheet Automation, Fully Local</strong></p>
        <p>Brain Cells combines the best open source projects to transform every spreadsheet cell into an intelligent "brain cell" capable of understanding and transforming your data.</p>
        
        <ul class="feature-list">
            <li>Connect to Ollama for local LLM processing</li>
            <li>Use Hugging Face models for AI operations</li>
            <li>Complete privacy - your data never leaves your machine</li>
        </ul>
        
        <p><em>This bundle includes enhanced features inspired by Hugging Face AI Sheets, optimized for research use by KSU Office of Research.</em></p>
        
        <button class="get-started-btn" onclick="closeWelcome()">Get Started with Brain Cells</button>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <span class="logo">ü¶â</span>
            <div>
                <h1>Brain Cells</h1>
                <div class="tagline">Intelligent Spreadsheet Automation</div>
            </div>
        </div>
        <div class="nav-buttons">
            <button class="nav-btn" onclick="showAbout()">About</button>
            <button class="nav-btn" onclick="showHelp()">Help</button>
            <button class="nav-btn" onclick="window.location.href='mailto:ngoldbla@kennesaw.edu?subject=Feedback%20on%20Brain%20Cells'">Feedback</button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <h3>ü§ñ AI Configuration</h3>
            
            <label for="modelSelect">Model Provider:</label>
            <select id="modelSelect" class="model-select">
                <option value="ollama">Ollama (Local)</option>
                <option value="huggingface">Hugging Face</option>
                <option value="openai">OpenAI</option>
            </select>
            
            <label for="ollamaModel">Ollama Model:</label>
            <select id="ollamaModel" class="model-select">
                <option value="mistral">Mistral 7B</option>
                <option value="phi">Phi-2</option>
                <option value="gpt-oss:20b">GPT-OSS 20B</option>
                <option value="llama2">Llama 2</option>
            </select>
            
            <h3 style="margin-top: 2rem;">üï∑Ô∏è Data Sources</h3>
            <button class="tool-btn" style="width: 100%;" onclick="importData()">
                Import CSV/Excel
            </button>
            
            <h3 style="margin-top: 2rem;">üìä Operations</h3>
            <button class="tool-btn" style="width: 100%; margin-bottom: 0.5rem;" onclick="runPrompt()">
                Run AI Prompt
            </button>
            <button class="tool-btn" style="width: 100%;" onclick="enrichData()">
                Enrich Data
            </button>
        </div>

        <!-- Spreadsheet -->
        <div class="spreadsheet-container">
            <div class="toolbar">
                <button class="tool-btn" onclick="addRow()">‚ûï Add Row</button>
                <button class="tool-btn" onclick="addColumn()">‚ûï Add Column</button>
                <button class="tool-btn" onclick="clearSheet()">üóëÔ∏è Clear</button>
                <button class="tool-btn" onclick="saveSheet()">üíæ Save</button>
                <button class="tool-btn" onclick="exportSheet()">üì§ Export</button>
            </div>
            
            <div class="spreadsheet">
                <table id="brainCellsTable">
                    <thead>
                        <tr>
                            <th>A</th>
                            <th>B</th>
                            <th>C</th>
                            <th>D</th>
                            <th>E</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Dynamic rows will be added here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        Brain Cells is a bundle created from the open source 
        <a href="https://huggingface.co/spaces/HuggingFace/ai-sheets" target="_blank">Hugging Face AI Sheets</a> project
        ‚Ä¢ Developed by Dylan Goldblatt at 
        <a href="https://research.kennesaw.edu" target="_blank">KSU Office of Research</a>
        ‚Ä¢ <a href="mailto:ngoldbla@kennesaw.edu?subject=Feedback%20on%20Brain%20Cells">Contact</a>
    </footer>

    <script>
        // Initialize the spreadsheet
        let data = [];
        let currentCell = null;

        function initSpreadsheet() {
            const tbody = document.getElementById('tableBody');
            for (let i = 0; i < 20; i++) {
                const row = document.createElement('tr');
                for (let j = 0; j < 5; j++) {
                    const cell = document.createElement('td');
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.placeholder = `Cell ${String.fromCharCode(65 + j)}${i + 1}`;
                    
                    // Add brain indicator
                    const indicator = document.createElement('span');
                    indicator.className = 'brain-indicator';
                    indicator.textContent = 'üß†';
                    
                    input.onfocus = () => {
                        if (currentCell) currentCell.classList.remove('cell-active');
                        cell.classList.add('cell-active');
                        currentCell = cell;
                    };
                    
                    input.oninput = async () => {
                        // Process =AI() formulas
                        if (input.value.startsWith('=AI(')) {
                            const match = input.value.match(/^=AI\(["'](.+?)["']\)/);
                            if (match) {
                                const prompt = match[1];
                                cell.classList.add('processing');
                                
                                try {
                                    const modelSelect = document.getElementById('ollamaModel');
                                    const model = modelSelect ? modelSelect.value : 'gpt-oss:20b';
                                    
                                    const response = await fetch('http://localhost:11434/api/generate', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            model: model,
                                            prompt: prompt,
                                            stream: false
                                        })
                                    });
                                    
                                    if (response.ok) {
                                        const data = await response.json();
                                        if (data.response) {
                                            input.value = data.response.trim();
                                            indicator.style.opacity = '1';
                                        }
                                    } else {
                                        input.value = 'Error: Ollama not available';
                                    }
                                } catch (error) {
                                    console.error('Error calling Ollama:', error);
                                    input.value = 'Error: Could not connect to Ollama';
                                } finally {
                                    cell.classList.remove('processing');
                                }
                            }
                        }
                    };
                    
                    cell.appendChild(input);
                    cell.appendChild(indicator);
                    row.appendChild(cell);
                }
                tbody.appendChild(row);
            }
        }

        function closeWelcome() {
            document.getElementById('welcomeModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
        }

        function showAbout() {
            window.location.href = '/about.html';
        }

        function showHelp() {
            alert('Brain Cells Help\n\n' +
                  '‚Ä¢ Use =AI("prompt") to run AI operations on cells\n' +
                  '‚Ä¢ Connect to Ollama at http://localhost:11434\n' +
                  '‚Ä¢ Import data from CSV\n' +
                  '‚Ä¢ Each cell can process data intelligently\n\n' +
                  'For more help, email ngoldbla@kennesaw.edu');
        }

        function importData() {
            alert('Import feature coming soon!\n\n' +
                  'For now, paste CSV data directly into cells.');
        }

        async function runPrompt() {
            const prompt = window.prompt('Enter your AI prompt for selected cells:');
            if (!prompt || !currentCell) return;
            
            const input = currentCell.querySelector('input');
            if (!input) return;
            
            currentCell.classList.add('processing');
            
            try {
                // Get selected model
                const modelSelect = document.getElementById('ollamaModel');
                const model = modelSelect ? modelSelect.value : 'gpt-oss:20b';
                
                // Prepare context with cell value
                const cellValue = input.value || '';
                const fullPrompt = cellValue ? 
                    `Context: ${cellValue}\n\nTask: ${prompt}` : 
                    prompt;
                
                // Try to call Ollama API
                const response = await fetch('http://localhost:11434/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: model,
                        prompt: fullPrompt,
                        stream: false
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.response) {
                        input.value = data.response.trim();
                        currentCell.querySelector('.brain-indicator').style.opacity = '1';
                    }
                } else {
                    // Fallback to demo mode if Ollama is not available
                    alert('Ollama not available. Make sure Docker containers are running.\n\nTo use AI features:\n1. Run: docker compose up -d\n2. Wait for Ollama to download models\n3. Refresh this page');
                }
            } catch (error) {
                console.error('Error calling Ollama:', error);
                alert('Could not connect to Ollama. Make sure:\n1. Docker containers are running (docker compose up -d)\n2. Ollama is accessible at http://localhost:11434\n3. The selected model is downloaded');
            } finally {
                currentCell.classList.remove('processing');
            }
        }

        function enrichData() {
            alert('Data enrichment will process all cells with AI.\n\n' +
                  'Configure your model provider in the sidebar first.');
        }

        function addRow() {
            const tbody = document.getElementById('tableBody');
            const row = document.createElement('tr');
            for (let j = 0; j < 5; j++) {
                const cell = document.createElement('td');
                const input = document.createElement('input');
                input.type = 'text';
                cell.appendChild(input);
                row.appendChild(cell);
            }
            tbody.appendChild(row);
        }

        function addColumn() {
            alert('Adding columns feature coming soon!');
        }

        function clearSheet() {
            if (confirm('Clear all data?')) {
                document.querySelectorAll('#tableBody input').forEach(input => {
                    input.value = '';
                });
            }
        }

        function saveSheet() {
            alert('Spreadsheet saved! (Demo mode)');
        }

        function exportSheet() {
            alert('Export to CSV/Excel coming soon!');
        }

        // Initialize on load
        window.onload = () => {
            initSpreadsheet();
            
            // Show welcome modal after a short delay
            setTimeout(() => {
                document.getElementById('welcomeModal').style.display = 'block';
                document.getElementById('modalOverlay').style.display = 'block';
            }, 500);
        };
    </script>
</body>
</html>